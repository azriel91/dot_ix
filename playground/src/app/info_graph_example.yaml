---
graph_style: circle # box, circle
direction: vertical
hierarchy:
  github:
    github_app_zip: {}

  localhost:
    app_download: {}
    app_extract: {}

  aws:
    iam_policy: {}
    iam_role: {}
    instance_profile: {}
    s3_bucket:
      s3_object: {}

node_names:
  localhost:        "localhost"
  aws:              "aws"
  github:           "github"
  github_app_zip:   "app.zip"
  app_download:     "app_download"
  app_extract:      "app_extract"
  iam_policy:       "iam_policy"
  iam_role:         "iam_role"
  instance_profile: "instance_profile"
  s3_bucket:        "s3_bucket"
  s3_object:        "s3_object"

node_descs:
  localhost:        "Your computer"
  aws:              "Amazon Web Services"
  github:           "Github"
  # github_app_zip:   '~'
  app_download:     "app.zip"
  app_extract:      "/opt/app"
  iam_policy:       "EC2: Allow S3 Read"
  iam_role:         "EC2 IAM policy attachment"
  instance_profile: "EC2 instance role attachment"
  s3_bucket:        "demo-artifacts"
  s3_object:        "app.zip"

node_emojis:
  localhost:        💻
  aws:              ☁️
  github:           🐙
  github_app_zip:   📁
  app_download:     📥
  app_extract:      📂
  iam_policy:       📝
  iam_role:         🔰
  instance_profile: 🏷️
  s3_bucket:        🪣
  s3_object:        📁

edges:
  app_download__app_extract: [app_download, app_extract]
  iam_policy__iam_role: [iam_policy, iam_role]
  iam_role__instance_profile: [iam_role, instance_profile]
  app_download__s3_object: [app_download, s3_object]
  iam_policy__s3_object: [iam_policy, s3_object]
  github_app_zip__app_download_request: [github_app_zip:sw, app_download:nw]
  github_app_zip__app_download_response: [github_app_zip:se, app_download:ne]

graphviz_attrs:
  edge_constraints:
    github_app_zip__app_download_request: true
    github_app_zip__app_download_response: true
    app_download__s3_object: true
  edge_minlen_default: 1
  edge_minlens:
    github_app_zip__app_download_request: 1
    github_app_zip__app_download_response: 1
  edge_dirs: # forward, back, both, none
    github_app_zip__app_download_request: back

  # "node", "cluster", "graph", "array(_flags)?(n)?"
  #
  # array flags:
  #
  # - <none>: row major order
  # - c: column major order
  # - t: align clusters top (horizontal graphs)
  # - b: align clusters bottom (horizontal graphs)
  # - l: align clusters left (vertical graphs)
  # - r: align clusters right (vertical graphs)
  pack_mode: "array_t"

tags:
  tag_ready: "Ready"
  tag_waiting: "Waiting"

tag_items:
  tag_ready: [iam_policy, iam_role]
  tag_waiting: [instance_profile, app_extract, github_app_zip__app_download_response]

theme:
  merge_with_base: true
  styles:
    node_defaults:
      stroke_width: '1'
      extra: 'rounded-lg'
    edge_defaults:
      extra: hidden
    github_app_zip__app_extract:
      cursor: 'progress' # https://tailwindcss.com/docs/cursor
      extra: ''
    blue_animated: &blue_animated
      shape_color: blue
      stroke_style: dashed  # shorthand for [&>path]:[stroke-dasharray:3]
      stroke_width: '[2px]'
      stroke_shade_normal: '600'
      fill_shade_normal: '500'
      extra: >-
        [&>path]:animate-[stroke-dashoffset-move_2s_linear_infinite]
    app_download__s3_object:
      <<: *blue_animated
    github_app_zip__app_download_request:
      <<: *blue_animated
      shape_color: violet
      stroke_style: "dasharray:0,80,12,2,4,2,2,2,1,2,1,120"
      stroke_width: '[1px]'
      extra: >-
        [&>path]:animate-[stroke-dashoffset-move-request_2s_linear_infinite]
    github_app_zip__app_download_response:
      <<: *blue_animated
      shape_color: purple
      stroke_style: "dasharray:0,120,1,2,1,2,2,2,4,2,8,2,20,80"
      stroke_width: '[2px]'
      extra: >-
        [&>path]:animate-[stroke-dashoffset-move-response_2s_linear_infinite]
    github_app_zip:
      shape_color: green
    app_download:
      shape_color: green
    s3_object:
      shape_color: blue
      stroke_style: "dasharray:0.5,3,0.5,3,0.5,3,0.5,3,6,3,12,30"
      stroke_width: '[2px]'
      extra: |-
        [&>ellipse]:[stroke-linecap:round]
        [&>ellipse]:animate-[ellipse-spin_1.5s_linear_infinite]
    light: &light
      fill_shade_normal: '100'
      fill_shade_hover: '50'
      fill_shade_focus: '100'
      fill_shade_active: '100'
      stroke_shade_normal: '400'
      stroke_shade_hover: '300'
      stroke_shade_active: '500'
      stroke_style: dotted
      padding: '3'
    aws:
      <<: *light
      shape_color: amber
      outline_color: yellow
    localhost:
      <<: *light
      shape_color: blue
    github:
      <<: *light
      shape_color: gray
    s3_bucket:
      fill_shade_normal: '200'
      fill_shade_hover: '100'
      fill_shade_focus: '200'
      fill_shade_active: '200'
      stroke_shade_normal: '500'
      stroke_shade_hover: '400'
      stroke_shade_active: '600'
      stroke_style: dotted
      padding: '3'
      shape_color: amber

# We always use the `focus` pseudo class.
#
# There are other pseudo classes, but it doesn't appear useful enough for most of those to be
# used. The most likely one is `hover`.
#
# See <https://tailwindcss.com/docs/hover-focus-and-other-states#pseudo-class-reference>
tag_styles_focus:
  tag_ready:
    # Attaches the following to nodes:
    #
    # From defaults:
    #
    # ```text
    # peer-focus/{tag_id}:[&>path]:fill-lime-200
    # peer-focus/{tag_id}:[&>ellipse]:fill-lime-200
    # ```
    #
    # Specified:
    #
    # ```text
    # peer-focus/tag_ready:[&>path]:focus:outline-red-600
    # peer-focus/tag_ready:[&>path]:focus:outline-[2px]
    # peer-focus/tag_ready:[&>path]:focus:outline-dashed
    # peer-focus/tag_ready:[&>ellipse]:focus:outline-red-600
    # peer-focus/tag_ready:[&>ellipse]:focus:outline-[2px]
    # peer-focus/tag_ready:[&>ellipse]:focus:outline-dashed
    # ```
    node_styles:
      outline_color: red
      outline_style: dashed
      outline_width: '[2px]'
      outline_shade: '600'

    # Attaches the following to edges:
    #
    # From defaults:
    #
    # ```text
    # peer-focus/{tag_id}:[&>path]:stroke-lime-200
    # ```
    #
    # Specified:
    #
    # ```text
    # peer-focus/tag_ready:[&>path]:focus:outline-red-600
    # peer-focus/tag_ready:[&>path]:focus:outline-[2px]
    # peer-focus/tag_ready:[&>path]:focus:outline-dashed
    # ```
    edge_styles:
      outline_color: red
      outline_style: dashed
      outline_width: '[2px]'
      outline_shade: '600'
      extra: 'stroke-lime-200'
  tag_waiting:
    node_styles:
      outline_color: red
      outline_style: dashed
      outline_width: '[2px]'
      outline_shade: '600'
    edge_styles:
      outline_color: red
      outline_style: dashed
      outline_width: '[2px]'
      outline_shade: '600'
      shape_color: lime

css: >-
  @keyframes ellipse-spin {
    0%   { stroke-dashoffset: 65; }
    100% { stroke-dashoffset: 0; }
  }
  @keyframes stroke-dashoffset-move {
    0%   { stroke-dashoffset: 30; }
    100% { stroke-dashoffset: 0; }
  }
  @keyframes stroke-dashoffset-move-request {
    0%   { stroke-dashoffset: 0; }
    100% { stroke-dashoffset: 228; }
  }
  @keyframes stroke-dashoffset-move-response {
    0%   { stroke-dashoffset: 0; }
    100% { stroke-dashoffset: -248; }
  }
